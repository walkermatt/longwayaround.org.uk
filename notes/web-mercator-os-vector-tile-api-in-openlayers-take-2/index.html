<!DOCTYPE html>
<html lang="en">
<head>
        <title>Web Mercator OS Vector Tile API in OpenLayers - Take #2</title>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, target-densitydpi=device-dpi">
        <link rel="stylesheet" href="https://longwayaround.org.uk/theme/css/main.css" type="text/css" />
        <link href="https://longwayaround.org.uk/feeds/all.rss.xml" type="application/atom+xml" rel="alternate" title="longwayaround.org.uk RSS Feed" />

        <!--[if IE]>
                <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

        <!--[if lte IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="https://longwayaround.org.uk/css/ie.css"/>
                <script src="https://longwayaround.org.uk/js/IE8.js" type="text/javascript"></script><![endif]-->

        <!--[if lt IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="https://longwayaround.org.uk/css/ie6.css"/><![endif]-->

</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">longwayaround.org.uk  <strong>taking the scenic route and enjoying the journey</strong></a></h1>
                <nav>
                <ul>
                    <li class="active"><a href="https://longwayaround.org.uk/notes/">notes</a></li>
                </ul>
                </nav>
                    <ul class="social">
                        <li><a href="https://longwayaround.org.uk/feeds/all.rss.xml" rel="alternate"><img src="https://longwayaround.org.uk/theme/images/icons/gosquared/18/rss.png" title="rss" width="18" height="18" /></a></li>
                    <li><a href="https://uk.linkedin.com/in/walkermatt"><img src="https://longwayaround.org.uk/theme/images/icons/gosquared/18/linkedin.png" title="linkedin" width="18" height="18" /></a></li>
                    <li><a href="https://github.com/organizations/AstunTechnology"><img src="https://longwayaround.org.uk/theme/images/icons/gosquared/18/github.png" title="github" width="18" height="18" /></a></li>
                    <li><a href="https://github.com/walkermatt"><img src="https://longwayaround.org.uk/theme/images/icons/gosquared/18/github.png" title="github" width="18" height="18" /></a></li>
                    <li><a href="https://twitter.com/_walkermatt"><img src="https://longwayaround.org.uk/theme/images/icons/gosquared/18/twitter.png" title="twitter" width="18" height="18" /></a></li>
                    </ul>
        </header><!-- /#banner -->
<section id="content" class="body">
<article>
        <abbr class="published" title="2022-09-05T08:05:00+01:00">Mon 05 September 2022</abbr>
        <header> <h1 class="entry-title"><a href=""
        rel="bookmark" title="Permalink to Web Mercator OS Vector Tile API in OpenLayers - Take #2">Web Mercator OS Vector Tile API in OpenLayers - Take #2</a></h1>  </header>
        <div class="entry-content">
        <p>This is an update to my <a class="reference external" href="/notes/web-mercator-os-vector-tile-api-in-openlayers/">previous post</a> on the same subject.</p>
<p>Thanks to <a class="reference external" href="https://twitter.com/ahoce/status/1545409888226099200">some feedback from Andreas Hocevar</a> and <a class="reference external" href="https://github.com/openlayers/ol-mapbox-style/pull/618">a pull request I made to ol-mapbox-style</a> adding a Vector Tile layer of Ordnance Survey data from the OS Data Hub to an OpenLayers map in Web Mercator is a little easier than it was <a class="reference external" href="/notes/web-mercator-os-vector-tile-api-in-openlayers/">a few months ago</a> ðŸŽ‰</p>
<p>The following uses <a class="reference external" href="https://github.com/openlayers/create-ol-app">create-ol-app</a> to create a basic OpenLayers app, we then add the <a class="reference external" href="https://github.com/openlayers/ol-mapbox-style/pull/618">ol-mapbox-style</a> package and install the other dependencies:</p>
<div class="highlight"><pre><span></span><span class="c1"># Create a new OpenLayers app in a folder called os-vt-api-ol</span>
npx create-ol-app os-vt-api-ol

<span class="c1"># Change to the newly created folder which contains our app</span>
<span class="nb">cd</span> os-vt-api-ol/

<span class="c1"># Install the ol-mapbox-style package from npm</span>
npm i ol-mapbox-style

<span class="c1"># Install the other dependencies (vite and ol)</span>
npm i

<span class="c1"># Start the vite local web server which reloads during development (see the &quot;start&quot; script in package.json)</span>
npm start
</pre></div>
<p>Next update the code to add the OS Vector Tile layer:</p>
<div class="section" id="main-js">
<h2><tt class="docutils literal">main.js</tt></h2>
<div class="highlight"><pre><span></span><span class="kr">import</span> <span class="s1">&#39;./style.css&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">Map</span><span class="p">,</span> <span class="nx">View</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;ol&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">VectorTileLayer</span> <span class="nx">from</span> <span class="s1">&#39;ol/layer/VectorTile&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">transform</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;ol/proj&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">applyStyle</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;ol-mapbox-style&#39;</span><span class="p">;</span>

<span class="kd">let</span> <span class="nx">OS_API_KEY</span> <span class="o">=</span> <span class="s1">&#39;YOUR_OS_API_KEY&#39;</span><span class="p">;</span>

<span class="kd">let</span> <span class="nx">OsVtLyr</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">VectorTileLayer</span><span class="p">({</span>
  <span class="nx">declutter</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
<span class="p">});</span>

<span class="nx">applyStyle</span><span class="p">(</span>
  <span class="nx">OsVtLyr</span><span class="p">,</span>
  <span class="s1">&#39;https://api.os.uk/maps/vector/v1/vts/resources/styles?srs=3857&amp;key=&#39;</span> <span class="o">+</span>
    <span class="nx">OS_API_KEY</span><span class="p">,</span>
  <span class="s1">&#39;&#39;</span><span class="p">,</span>
  <span class="p">{</span>
    <span class="c1">// Specify the optional transformRequest function which is</span>
    <span class="c1">// called before each resource associated with the style</span>
    <span class="c1">// is fetched. In this instance we are ensuring the `srs`</span>
    <span class="c1">// parameter is set to `3857` (Web Mercator) when fetching</span>
    <span class="c1">// each resource (Source, Sprite, Tiles etc.). Full docs at</span>
    <span class="c1">// https://github.com/openlayers/ol-mapbox-style#transformRequest</span>
    <span class="nx">transformRequest</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">url</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">URL</span><span class="p">(</span><span class="nx">url</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">url</span><span class="p">.</span><span class="nx">searchParams</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="s1">&#39;srs&#39;</span><span class="p">))</span> <span class="p">{</span>
        <span class="nx">url</span><span class="p">.</span><span class="nx">searchParams</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">&#39;srs&#39;</span><span class="p">,</span> <span class="s1">&#39;3857&#39;</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="k">new</span> <span class="nx">Request</span><span class="p">(</span><span class="nx">url</span><span class="p">);</span>
    <span class="p">},</span>
  <span class="p">}</span>
<span class="p">).</span><span class="nx">then</span><span class="p">((</span><span class="nx">e</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="c1">// Once the style has been applied set the attribution which is missing</span>
  <span class="c1">// from the source document</span>
  <span class="nx">OsVtLyr</span>
    <span class="p">.</span><span class="nx">getSource</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">setAttributions</span><span class="p">(</span>
      <span class="s1">&#39;&amp;copy; &lt;a href=&quot;http://www.ordnancesurvey.co.uk/&quot;&gt;Ordnance Survey&lt;/a&gt;&#39;</span>
    <span class="p">);</span>
<span class="p">});</span>

<span class="kr">const</span> <span class="nx">map</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Map</span><span class="p">({</span>
  <span class="nx">target</span><span class="o">:</span> <span class="s1">&#39;map&#39;</span><span class="p">,</span>
  <span class="nx">layers</span><span class="o">:</span> <span class="p">[</span><span class="nx">OsVtLyr</span><span class="p">],</span>
  <span class="nx">view</span><span class="o">:</span> <span class="k">new</span> <span class="nx">View</span><span class="p">({</span>
    <span class="nx">center</span><span class="o">:</span> <span class="nx">transform</span><span class="p">([</span><span class="o">-</span><span class="mf">2.333029</span><span class="p">,</span> <span class="mf">52.109524</span><span class="p">],</span> <span class="s1">&#39;EPSG:4326&#39;</span><span class="p">,</span> <span class="s1">&#39;EPSG:3857&#39;</span><span class="p">),</span>
    <span class="nx">zoom</span><span class="o">:</span> <span class="mi">14</span><span class="p">,</span>
  <span class="p">}),</span>
<span class="p">});</span>
</pre></div>
<p>See the comments in the code for an explanation of the steps involved. The you should end up with a map that looks something like this:</p>
<img alt="OpenLayers map showing styled OS Vector Tiles data for Malvern, UK" src="/files/os-vector-tile-openlayers.png" style="width: 100%;" />
</div>

<footer class="post-info">
    <abbr class="published" title="2022-09-05T08:05:00+01:00">Mon 05 September 2022</abbr>
<p>Tags: <a href="https://longwayaround.org.uk/tag/javascript.html">javascript</a> <a href="https://longwayaround.org.uk/tag/openlayers.html">openlayers</a> <a href="https://longwayaround.org.uk/tag/vector-tiles.html">vector-tiles</a> <a href="https://longwayaround.org.uk/tag/notes.html">notes</a> </p></footer><!-- /.post-info -->        </div><!-- /.entry-content -->
        <div class="comments">
            <div id="disqus_thread"></div>
            <script type="text/javascript">
               // Don't set the identifier so that comments are
               // associated with the url
               // var disqus_identifier = "notes/web-mercator-os-vector-tile-api-in-openlayers-take-2/";
               (function() {
               var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
               dsq.src = 'https://longwayaroundorguk.disqus.com/embed.js';
               (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
              })();
            </script>
        </div>

</article>
</section>
<section id="content" class="body">
<h1>Posts</h1>
<ul>
    <li><a href='../../notes/web-mercator-os-vector-tile-api-in-openlayers-take-2/'>Web Mercator OS Vector Tile API in OpenLayers - Take #2</a> - <abbr class="published" title="2022-09-05T08:05:00+01:00">Mon 05 September 2022</abbr></li>
    <li><a href='../../notes/web-mercator-os-vector-tile-api-in-openlayers/'>Web Mercator OS Vector Tile API in OpenLayers</a> - <abbr class="published" title="2022-06-23T21:56:00+01:00">Thu 23 June 2022</abbr></li>
    <li><a href='../../notes/writing-small-text-filters-for-the-shell-and-vim/'>Writing small text filters for the shell and Vim</a> - <abbr class="published" title="2022-06-22T21:56:00+01:00">Wed 22 June 2022</abbr></li>
    <li><a href='../../notes/mapserver-postgis-performance/'>MapServer PostGIS Performance</a> - <abbr class="published" title="2019-09-20T12:00:00+01:00">Fri 20 September 2019</abbr></li>
    <li><a href='../../notes/postgres-information-functions/'>Postgres Information Functions</a> - <abbr class="published" title="2017-02-18T07:55:00+00:00">Sat 18 February 2017</abbr></li>
    <li><a href='../../notes/openlayers-2-custom-build/'>OpenLayers 2 Custom Build</a> - <abbr class="published" title="2016-04-26T14:00:00+01:00">Tue 26 April 2016</abbr></li>
    <li><a href='../../notes/testing-python-postgres/'>Testing Python &amp; Postgres</a> - <abbr class="published" title="2015-10-12T21:00:00+01:00">Mon 12 October 2015</abbr></li>
    <li><a href='../../notes/read-only-postgres-database/'>Read-only Postgres database</a> - <abbr class="published" title="2015-09-08T13:00:00+01:00">Tue 08 September 2015</abbr></li>
    <li><a href='../../notes/loading-postgis/'>Loading PostGIS</a> - <abbr class="published" title="2014-11-20T00:00:00+00:00">Thu 20 November 2014</abbr></li>
    <li><a href='../../notes/practical-openlayers-3-leaflet/'>Practical OpenLayers 3 &amp; Leaflet</a> - <abbr class="published" title="2014-09-07T21:30:00+01:00">Sun 07 September 2014</abbr></li>
    <li><a href='../../notes/gnu-parallel-all-the-things/'>GNU Parallel all the things!</a> - <abbr class="published" title="2014-07-17T19:45:00+01:00">Thu 17 July 2014</abbr></li>
    <li><a href='../../notes/first-few-months-of-clojure/'>First few months of Clojure</a> - <abbr class="published" title="2014-02-18T19:42:00+00:00">Tue 18 February 2014</abbr></li>
    <li><a href='../../notes/custom-geoserver-getfeatureinfo-template/'>Custom GeoServer GetFeatureInfo Template</a> - <abbr class="published" title="2013-10-18T17:24:00+01:00">Fri 18 October 2013</abbr></li>
    <li><a href='../../notes/using-leaflet-with-a-custom-projection-and-a-mapproxy-tms/'>Using Leaflet with a custom projection and a MapProxy TMS</a> - <abbr class="published" title="2012-07-02T21:06:00+01:00">Mon 02 July 2012</abbr></li>
    <li><a href='../../notes/greyscale-maps-with-mapserver/'>Greyscale maps with MapServer</a> - <abbr class="published" title="2012-02-02T21:31:00+00:00">Thu 02 February 2012</abbr></li>
    <li><a href='../../notes/disaggregate-multilinestrings-using-st_dump-postgis/'>Disaggregate MultiLineStrings using ST_Dump PostGIS</a> - <abbr class="published" title="2011-11-24T21:39:00+00:00">Thu 24 November 2011</abbr></li>
    <li><a href='../../notes/recursively-delete-empty-directories/'>Recursively delete empty directories</a> - <abbr class="published" title="2011-03-28T10:31:00+01:00">Mon 28 March 2011</abbr></li>
    <li><a href='../../notes/convert-a-directory-of-tiffs-to-greyscale-using-imagemagick/'>Convert a directory of TIFFs to greyscale using ImageMagick</a> - <abbr class="published" title="2011-01-07T17:53:00+00:00">Fri 07 January 2011</abbr></li>
    <li><a href='../../notes/build-ogr-18-with-gml-wfs-and-postgis-support-on-ubuntu-1004/'>Build OGR 1.8 with GML, WFS and PostGIS support on Ubuntu 10.04</a> - <abbr class="published" title="2010-12-19T21:06:00+00:00">Sun 19 December 2010</abbr></li>
</ul>
</section>
        <section id="extras" class="body">
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                    Powered by <a href="http://alexis.notmyidea.org/pelican/">Pelican</a> and <a href="http://python.org">Python</a>, using a modified <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a> theme, background from <a href="http://subtlepatterns.com">Subtle Patterns</a> and icons from <a href="https://www.gosquared.com/blog/archives/2925">GoSocial</a>.
                </address><!-- /#about -->
        </footer><!-- /#contentinfo -->

<script type="text/javascript">
    var disqus_shortname = 'longwayaroundorguk';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'https://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
</body>
</html>