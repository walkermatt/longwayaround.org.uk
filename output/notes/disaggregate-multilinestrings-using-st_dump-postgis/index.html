<!DOCTYPE html>
<html lang="en">
<head>
        <title>Disaggregate MultiLineStrings using ST_Dump PostGIS</title>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, target-densitydpi=device-dpi">
        <link rel="stylesheet" href="../.././theme/css/main.css" type="text/css" />
        <link href="../.././" type="application/atom+xml" rel="alternate" title="longwayaround.org.uk ATOM Feed" />
        
        <link href="../.././feeds/all.rss.xml" type="application/atom+xml" rel="alternate" title="longwayaround.org.uk RSS Feed" />
        

        <!--[if IE]>
                <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

        <!--[if lte IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="../.././css/ie.css"/>
                <script src="../.././js/IE8.js" type="text/javascript"></script><![endif]-->

        <!--[if lt IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="../.././css/ie6.css"/><![endif]-->

</head>

<body id="index" class="home">

        <header id="banner" class="body">
                <h1><a href="../../.">longwayaround.org.uk  <strong>taking the scenic route and enjoying the journey</strong></a></h1>
                <nav>
                <ul>
                
                
                    <li class="active"><a href="../.././notes/">notes</a></li>
                
                
                
                    <li><a href="../.././pages/about/">about</a></li>
                
                
                </ul>
                </nav>
                
                    <ul class="social">
                        <li><a href="../.././" rel="alternate"><img src="../.././theme/images/icons/gosquared/18/rss.png" title="atom" width="18" height="18" /></a></li>
                        
                        <li><a href="../.././feeds/all.rss.xml" rel="alternate"><img src="../.././theme/images/icons/gosquared/18/rss.png" title="rss" width="18" height="18" /></a></li>
                        
                    
                    <li><a href="http://uk.linkedin.com/in/walkermatt"><img src="../.././theme/images/icons/gosquared/18/linkedin.png" title="linkedin" width="18" height="18" /></a></li>
                    
                    <li><a href="http://delicious.com/walkermatt"><img src="../.././theme/images/icons/gosquared/18/delicious.png" title="delicious" width="18" height="18" /></a></li>
                    
                    <li><a href="http://github.com/organizations/AstunTechnology"><img src="../.././theme/images/icons/gosquared/18/github.png" title="github" width="18" height="18" /></a></li>
                    
                    <li><a href="http://github.com/walkermatt"><img src="../.././theme/images/icons/gosquared/18/github.png" title="github" width="18" height="18" /></a></li>
                    
                    <li><a href="http://twitter.com/_walkermatt"><img src="../.././theme/images/icons/gosquared/18/twitter.png" title="twitter" width="18" height="18" /></a></li>
                    
                    </ul>
                
        </header><!-- /#banner -->
                
<section id="content" class="body">    
<article>
        <header> <h1 class="entry-title"><a href=""
        rel="bookmark" title="Permalink to Disaggregate MultiLineStrings using ST_Dump PostGIS">Disaggregate MultiLineStrings using ST_Dump PostGIS</a></h1>  </header>
        <div class="entry-content">
        <footer class="post-info">
        <abbr class="published" title="2011-11-24T21:39:00">
                Thu 24 November 2011
        </abbr>

        
        <address class="vcard author">
                By <a class="url fn" href="../.././author/walkermatt.html">walkermatt</a>
        </address>
        
<p>In <a href="../.././category/notes.html">notes</a>. </p>
<p>tags: <a href="../.././tag/postgis.html">postgis</a> </p>


</footer><!-- /.post-info -->
        <p>PostGIS the spatial extension to the PostgreSQL database provides a host of functions for querying, creating and manipulating geometries within the database. ST_Dump allows you to disaggregate collection and multi geometries such as MultiPolygon and MultiLineSting easily. The example below demonstrates starting with a table that contains one row with a MultiLineString geometry and another with a LineString and running a query to disaggregate returning three rows all with a LineString geometry.</p>
<p>Create a table for our demo data:</p>
<div class="highlight"><pre><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">complex</span>

<span class="p">(</span>

   <span class="n">id</span> <span class="nb">serial</span><span class="p">,</span>

   <span class="ss">&quot;name&quot;</span> <span class="nb">text</span><span class="p">,</span>

   <span class="n">geom</span> <span class="n">geometry</span>

<span class="p">);</span>
</pre></div>
<p>Insert one row with a MultiLineString with two parts ('Bob') and another with a single LineString ('Harry')</p>
<div class="highlight"><pre><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">complex</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">geom</span><span class="p">)</span>

  <span class="k">VALUES</span> <span class="p">(</span>

    <span class="s1">&#39;Bob&#39;</span><span class="p">,</span>

    <span class="n">ST_GeomFromEWKT</span><span class="p">(</span><span class="s1">&#39;MULTILINESTRING((498376.89 651569.6,498372.28 651571.89),(498372.28 651571.89,498371.77 651576.05))&#39;</span><span class="p">)</span>

  <span class="p">);</span>



<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">complex</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">geom</span><span class="p">)</span>

  <span class="k">VALUES</span> <span class="p">(</span>

    <span class="s1">&#39;Harry&#39;</span><span class="p">,</span>

    <span class="n">ST_GeomFromEWKT</span><span class="p">(</span><span class="s1">&#39;LINESTRING(598376.89 751569.6,398372.75 658771.03)&#39;</span><span class="p">)</span>

  <span class="p">);</span>
</pre></div>
<p>Query to show we have two rows one of which has a MultiLineString geometry:</p>
<div class="highlight"><pre><span class="k">SELECT</span> <span class="o">*</span><span class="p">,</span> <span class="n">ST_GeometryType</span><span class="p">(</span><span class="n">geom</span><span class="p">)</span> <span class="k">as</span> <span class="n">geom_type</span><span class="p">,</span> <span class="n">ST_AsEWKT</span><span class="p">(</span><span class="n">geom</span><span class="p">)</span> <span class="k">as</span> <span class="n">geom_wkt</span> <span class="k">from</span> <span class="n">complex</span><span class="p">;</span>
</pre></div>
<p>Results:</p>
<table border="1" class="docutils">
<colgroup>
<col width="2%" />
<col width="4%" />
<col width="18%" />
<col width="13%" />
<col width="62%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">id</th>
<th class="head">name</th>
<th class="head">geom</th>
<th class="head">geom_type</th>
<th class="head">geom_wkt</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>1</td>
<td>Bob</td>
<td>010500000002000000010200...</td>
<td>ST_MultiLineString</td>
<td>MULTILINESTRING((498376.89 651569.6,498372.28 651571.89),(498372.28 651571.89,498371.77 651576.05))</td>
</tr>
<tr><td>2</td>
<td>Harry</td>
<td>0102000000020000007B14AE...</td>
<td>ST_LineString</td>
<td>LINESTRING(598376.89 751569.6,598372.28 751571.89)</td>
</tr>
</tbody>
</table>
<p>Use the ST_Dump function to split the row with a MultiLineString into two rows each with a LineString and generate a decimal id composed of the original rows id and the LineString's position in the MultiLineString as the fractional part so that each row still has a unique id that's derived from it's original id:</p>
<div class="highlight"><pre><span class="k">SELECT</span>

  <span class="n">COALESCE</span><span class="p">((</span><span class="k">simple</span><span class="p">.</span><span class="n">id</span> <span class="o">||</span> <span class="s1">&#39;.&#39;</span> <span class="o">||</span> <span class="k">simple</span><span class="p">.</span><span class="n">path</span><span class="p">[</span><span class="mi">1</span><span class="p">]::</span><span class="nb">text</span><span class="p">)::</span><span class="nb">float</span><span class="p">,</span> <span class="k">simple</span><span class="p">.</span><span class="n">id</span><span class="p">)</span> <span class="k">as</span> <span class="n">id</span><span class="p">,</span>

  <span class="k">simple</span><span class="p">.</span><span class="n">name</span><span class="p">,</span>

  <span class="k">simple</span><span class="p">.</span><span class="n">simple_geom</span> <span class="k">as</span> <span class="n">geom</span><span class="p">,</span>

  <span class="n">ST_GeometryType</span><span class="p">(</span><span class="k">simple</span><span class="p">.</span><span class="n">simple_geom</span><span class="p">)</span> <span class="k">as</span> <span class="n">geom_type</span><span class="p">,</span>

  <span class="n">ST_AsEWKT</span><span class="p">(</span><span class="k">simple</span><span class="p">.</span><span class="n">simple_geom</span><span class="p">)</span> <span class="k">as</span> <span class="n">geom_wkt</span>

<span class="k">FROM</span> <span class="p">(</span>

  <span class="k">SELECT</span>

    <span class="n">dumped</span><span class="p">.</span><span class="o">*</span><span class="p">,</span>

    <span class="p">(</span><span class="n">dumped</span><span class="p">.</span><span class="n">geom_dump</span><span class="p">).</span><span class="n">geom</span> <span class="k">as</span> <span class="n">simple_geom</span><span class="p">,</span>

    <span class="p">(</span><span class="n">dumped</span><span class="p">.</span><span class="n">geom_dump</span><span class="p">).</span><span class="n">path</span> <span class="k">as</span> <span class="n">path</span>

  <span class="k">FROM</span> <span class="p">(</span>

    <span class="k">SELECT</span> <span class="o">*</span><span class="p">,</span> <span class="n">ST_Dump</span><span class="p">(</span><span class="n">geom</span><span class="p">)</span> <span class="k">AS</span> <span class="n">geom_dump</span> <span class="k">FROM</span> <span class="n">complex</span>

  <span class="p">)</span> <span class="k">as</span> <span class="n">dumped</span>

<span class="p">)</span> <span class="k">AS</span> <span class="k">simple</span><span class="p">;</span>
</pre></div>
<p>Results:</p>
<table border="1" class="docutils">
<colgroup>
<col width="5%" />
<col width="6%" />
<col width="26%" />
<col width="15%" />
<col width="48%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">id</th>
<th class="head">name</th>
<th class="head">geom</th>
<th class="head">geom_type</th>
<th class="head">geom_wkt</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>1.1</td>
<td>Bob</td>
<td>010200000002000000F6285C...</td>
<td>ST_LineString</td>
<td>LINESTRING(498376.89 651569.6,498372.28 651571.89)</td>
</tr>
<tr><td>1.2</td>
<td>Bob</td>
<td>010200000002000000EC51B8...</td>
<td>ST_LineString</td>
<td>LINESTRING(498372.28 651571.89,498371.77 651576.05)</td>
</tr>
<tr><td>2</td>
<td>Harry</td>
<td>0102000000020000007B14AE...</td>
<td>ST_LineString</td>
<td>LINESTRING(598376.89 751569.6,598372.28 751571.89)</td>
</tr>
</tbody>
</table>

        </div><!-- /.entry-content -->
        
        <div class="comments">
        <!-- <h2>Comments !</h2> -->
            <div id="disqus_thread"></div>
            <script type="text/javascript">
               // Don't set the identifier so that comments are
               // associated with the url
               // var disqus_identifier = "notes/disaggregate-multilinestrings-using-st_dump-postgis/";
               (function() {
               var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
               dsq.src = 'http://longwayaroundorguk.disqus.com/embed.js';
               (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
              })();
            </script>
        </div>
        

</article>
</section>
<section id="content" class="body">
<h1>Articles</h1>
<ul>

    <li><a href='../../notes/using-leaflet-with-a-custom-projection-and-a-mapproxy-tms/'>Using Leaflet with a custom projection and a MapProxy TMS</a></li>

    <li><a href='../../notes/greyscale-maps-with-mapserver/'>Greyscale maps with MapServer</a></li>

    <li><a href='../../notes/disaggregate-multilinestrings-using-st_dump-postgis/'>Disaggregate MultiLineStrings using ST_Dump PostGIS</a></li>

    <li><a href='../../notes/recursively-delete-empty-directories/'>Recursively delete empty directories</a></li>

    <li><a href='../../notes/convert-a-directory-of-tiffs-to-greyscale-using-imagemagick/'>Convert a directory of TIFFs to greyscale using ImageMagick</a></li>

    <li><a href='../../notes/build-ogr-18-with-gml-wfs-and-postgis-support-on-ubuntu-1004/'>Build OGR 1.8 with GML, WFS and PostGIS support on Ubuntu 10.04</a></li>

</ul>
</section>

        <section id="extras" class="body">
        
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                    <h3>Credits</h3>
                    Powered by <a href="http://alexis.notmyidea.org/pelican/">Pelican</a> and <a href="http://python.org">Python</a>, using a modified <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a> theme, background from <a href="http://subtlepatterns.com">Subtle Patterns</a> and icons from <a href="https://www.gosquared.com/blog/archives/2925">GoSocial</a>.
                </address><!-- /#about -->
        </footer><!-- /#contentinfo -->




<script type="text/javascript">
    var disqus_shortname = 'longwayaroundorguk';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>

</body>
</html>