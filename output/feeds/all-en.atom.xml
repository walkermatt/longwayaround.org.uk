<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>longwayaround.org.uk</title><link href="http://longwayaround.org.uk/" rel="alternate"></link><link href="http://longwayaround.org.uk/feeds/all-en.atom.xml" rel="self"></link><id>http://longwayaround.org.uk/</id><updated>2014-07-17T19:45:00+01:00</updated><entry><title>GNU Parallel all the things!</title><link href="http://longwayaround.org.uk/notes/gnu-parallel-all-the-things/" rel="alternate"></link><updated>2014-07-17T19:45:00+01:00</updated><author><name>walkermatt</name></author><id>tag:longwayaround.org.uk,2014-07-17:notes/gnu-parallel-all-the-things/</id><summary type="html">&lt;p&gt;I've been doing a lot of data processing recently and have been looking for a way of running bulk data loads into PostGIS in parallel to make use of all available cores. The work has mainly revolved around loading national cover of Ordnance Survey OS MasterMap and VectorMap local for &lt;a class="reference external" href="http://astuntechology.com/"&gt;Astun's&lt;/a&gt; base map services using &lt;a class="reference external" href="https://github.com/AstunTechnology/Loader"&gt;Loader&lt;/a&gt;. Loader doesn't have any parallel processing baked in but a &lt;a class="reference external" href="https://github.com/AstunTechnology/Loader/commit/199e66f7064e341b1365eb10a3d5a572b45b7fdb"&gt;small change to how it creates it's temporary directory&lt;/a&gt; allows multiple instance to be ran in parallel each processing a single file at a time. The key component to enable this is &lt;a class="reference external" href="http://www.gnu.org/software/parallel/"&gt;GNU Parallel&lt;/a&gt;, from the projects homepage:&lt;/p&gt;
&lt;blockquote&gt;
GNU parallel is a shell tool for executing jobs in parallel using one or more computers. A job can be a single command or a small script that has to be run for each of the lines in the input. The typical input is a list of files, a list of hosts, a list of users, a list of URLs, or a list of tables. A job can also be a command that reads from a pipe. GNU parallel can then split the input and pipe it into commands in parallel.&lt;/blockquote&gt;
&lt;p&gt;The way I've been using Parallel with Loader is to build a list of files to process using &lt;tt class="docutils literal"&gt;find&lt;/tt&gt; which is piped to &lt;tt class="docutils literal"&gt;parallel&lt;/tt&gt; which handles executing as many processes as there are cores (by default). For example:&lt;/p&gt;
&lt;div class="gist"&gt;
    &lt;script src='https://gist.github.com/99181c8454233fca2c8d.js?file=loader_parallel.sh'&gt;&lt;/script&gt;
    &lt;noscript&gt;
        &lt;pre&gt;&lt;code&gt;find /var/data/osmm/ -type f -print0 | \
parallel -0 python loader.py loader.config "src_dir={}"&lt;/code&gt;&lt;/pre&gt;
    &lt;/noscript&gt;
&lt;/div&gt;
&lt;p&gt;Using this approach on an 8 core EC2 server with SSD volumes national OS MasterMap Topography Layer can be loaded over a weekend.&lt;/p&gt;
&lt;p&gt;Another example of using &lt;tt class="docutils literal"&gt;parallel&lt;/tt&gt; would be to build on the bash one-liner that Tim Sutton posted a while back to &lt;a class="reference external" href="http://linfiniti.com/2012/03/another-bash-one-liner-load-all-natural-earth-layers-into-postgis-in-one-go/"&gt;load all natural earth layers into PostGIS in one go&lt;/a&gt;. Tim's original command used &lt;tt class="docutils literal"&gt;find&lt;/tt&gt; to build a list of files then loops over the list and runs &lt;tt class="docutils literal"&gt;shp2pgsql&lt;/tt&gt; for each piping the output to &lt;tt class="docutils literal"&gt;psql&lt;/tt&gt; to do the actual load. Here's the original command tweaked slightly to exclude the &lt;tt class="docutils literal"&gt;tools&lt;/tt&gt; directory and specify the encoding including timing:&lt;/p&gt;
&lt;div class="gist"&gt;
    &lt;script src='https://gist.github.com/99181c8454233fca2c8d.js?file=natural_earth_loop.sh'&gt;&lt;/script&gt;
    &lt;noscript&gt;
        &lt;pre&gt;&lt;code&gt;time for FILE in `find . -name '*.shp' -not -path "./tools/*"`; do \
    BASE=`basename $FILE .shp`; \
    shp2pgsql -s 4326 -I $FILE world.$BASE \
    | psql; done

real	4m31.680s&lt;/code&gt;&lt;/pre&gt;
    &lt;/noscript&gt;
&lt;/div&gt;
&lt;p&gt;The example below is the equivalent using &lt;cite&gt;parallel&lt;/cite&gt; which significantly reduces load time:&lt;/p&gt;
&lt;div class="gist"&gt;
    &lt;script src='https://gist.github.com/99181c8454233fca2c8d.js?file=natural_earth_parallel.sh'&gt;&lt;/script&gt;
    &lt;noscript&gt;
        &lt;pre&gt;&lt;code&gt;time find . -name '*.shp' -not -path "./tools/*" | \
     xargs -I '{}' echo 'shp2pgsql -s 4326 -I {} world.$(basename {} .shp) | psql' | \
     parallel

real	1m50.772s&lt;/code&gt;&lt;/pre&gt;
    &lt;/noscript&gt;
&lt;/div&gt;
&lt;p&gt;Again &lt;tt class="docutils literal"&gt;find&lt;/tt&gt; is used to build a list of input shapefiles which are piped to &lt;tt class="docutils literal"&gt;parallel&lt;/tt&gt; which builds a command that is piped to another &lt;tt class="docutils literal"&gt;parallel&lt;/tt&gt; instance to execute. By default &lt;tt class="docutils literal"&gt;parallel&lt;/tt&gt; provides the &lt;tt class="docutils literal"&gt;{}&lt;/tt&gt; replacement string for the current argument (file path in this case) and &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;{/.}&lt;/span&gt;&lt;/tt&gt; which strips the path and extension from when the replacement string is a file path.&lt;/p&gt;
</summary><category term="command-line"></category><category term="postgis"></category><category term="notes"></category></entry><entry><title>First few months of Clojure</title><link href="http://longwayaround.org.uk/notes/first-few-months-of-clojure/" rel="alternate"></link><updated>2014-02-18T19:42:00+00:00</updated><author><name>walkermatt</name></author><id>tag:longwayaround.org.uk,2014-02-18:notes/first-few-months-of-clojure/</id><summary type="html">&lt;p&gt;I've been learning a bit of Lisp on and off for a few years, I first read (about half of) &lt;a class="reference external" href="http://landoflisp.com/"&gt;Land of Lisp&lt;/a&gt;, then &lt;a class="reference external" href="http://www.gigamonkeys.com/book/"&gt;Practical Lisp&lt;/a&gt; then I came across &lt;a class="reference external" href="http://clojure.org/"&gt;Clojure&lt;/a&gt; a modern Lisp that runs on the JVM and since I've been reading &lt;a class="reference external" href="http://www.clojurebook.com/"&gt;Clojure Programming&lt;/a&gt; and working through &lt;a class="reference external" href="https://github.com/walkermatt/clojure-koans"&gt;koans&lt;/a&gt; and &lt;a class="reference external" href="https://github.com/walkermatt/yellow_belt_clojure_katas"&gt;katas&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;I've also built a small Clojure library and command-line app &lt;a class="reference external" href="https://github.com/walkermatt/gridref"&gt;GridRef&lt;/a&gt; to convert between an Ordnance Survey GB grid reference and British National Grid coordinates. While I was at it I built a web API &lt;a class="reference external" href="https://github.com/walkermatt/gridref-web"&gt;GridRef Web&lt;/a&gt; which exposes the conversion functions via a &lt;a class="reference external" href="https://github.com/ring-clojure/ring"&gt;Ring&lt;/a&gt; web app, hosted on Heroku and available at &lt;a class="reference external" href="http://gridref.longwayaround.org.uk/"&gt;http://gridref.longwayaround.org.uk/&lt;/a&gt;. Having a real (all be it small) project to work on has helped massively in learning and while I found the move from Python and JavaScript initially challenging I'm finding that I'm now thinking more functionally elsewhere.&lt;/p&gt;
&lt;p&gt;A few months in I'm really enjoying working with Clojure which feels like a thoughtfully designed language that incorporates sound theory in a practical way. The way the language and tooling favour interactive development really suits (especially &lt;a class="reference external" href="https://github.com/technomancy/leiningen"&gt;lein&lt;/a&gt; and &lt;a class="reference external" href="https://github.com/tpope/vim-fireplace"&gt;vim-fireplace&lt;/a&gt;) and I'm really drawn to the Lisp everything is an expression and code-as-data principles.&lt;/p&gt;
&lt;p&gt;What little contact I've had with the community as been positive, it feels like a community of bright individuals from a range of backgrounds which give it enthusiasm and a healthy balance.&lt;/p&gt;
&lt;p&gt;I was a bit hesitant of it being hosted on the JVM at first and it does suffer in places from the &amp;quot;window into hell&amp;quot; syndrome where you are exposed to the guts of the implementation but the infrastructure provided by the JVM seems to largely make up for this.&lt;/p&gt;
&lt;p&gt;I'm sure Clojure is likely to my language of choice for a while, I'm now looking forward to getting on to exploring some of it's key features such as concurrency which I've only scratched the surface of so far.&lt;/p&gt;
&lt;div class="section" id="resources"&gt;
&lt;h2&gt;Resources&lt;/h2&gt;
&lt;p&gt;Some links to resources I've found useful or interesting while learning the basics:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;a class="reference external" href="http://learnxinyminutes.com/docs/clojure/"&gt;Learn Clojure in Y minutes&lt;/a&gt; - very brief overview of the language basics by example&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="https://github.com/technomancy/leiningen"&gt;Leiningen&lt;/a&gt; - installing Leiningen will set up a sane Clojure enviroment for you and provide access to a Clojure Read Eval Print Loop via &lt;tt class="docutils literal"&gt;lein repl&lt;/tt&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="http://clojuredocs.org"&gt;ClojureDocs&lt;/a&gt; - community documentation site&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="http://www.braveclojure.com/"&gt;Clojure for the Brave and True&lt;/a&gt; -  witty book for beginners&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="https://github.com/walkermatt/yellow_belt_clojure_katas"&gt;Yellow belt Clojure katas&lt;/a&gt; - a handful of small exercises to learn from&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="https://github.com/walkermatt/clojure-koans"&gt;Clojure Koans&lt;/a&gt; - a much more extensive set of exercises&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="http://reddit.com/r/clojure"&gt;reddit.com/r/clojure&lt;/a&gt; - Clojure community on Reddit&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="https://github.com/walkermatt/clojure-intro"&gt;Intro to Clojure&lt;/a&gt; - brief intro based on learnxinyminutes.com/docs/clojure&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
</summary><category term="command-line"></category><category term="clojure"></category><category term="notes"></category></entry><entry><title>Custom GeoServer GetFeatureInfo Template</title><link href="http://longwayaround.org.uk/notes/custom-geoserver-getfeatureinfo-template/" rel="alternate"></link><updated>2013-10-18T17:24:00+01:00</updated><author><name>walkermatt</name></author><id>tag:longwayaround.org.uk,2013-10-18:notes/custom-geoserver-getfeatureinfo-template/</id><summary type="html">&lt;p&gt;The default  &lt;a class="reference external" href="http://geoserver.org/"&gt;GeoServer&lt;/a&gt; GetFeatureInfo Freemarker template is a simple table and doesn't work very well when displaying the content in a web map popup. It's a common requirement to change the GetFeatureInfo template to an unordered list, to capitalise the title and attribute names. Here is a sample &lt;cite&gt;content.ftl&lt;/cite&gt; that does just that and converts any attrubute values starting with &lt;cite&gt;http&lt;/cite&gt; into a link:&lt;/p&gt;
&lt;div class="gist"&gt;
    &lt;script src='https://gist.github.com/7052155.js?file=content.ftl'&gt;&lt;/script&gt;
    &lt;noscript&gt;
        &lt;pre&gt;&lt;code&gt;&lt;ul&gt;
&lt;#list features as feature&gt;
  &lt;li&gt;&lt;h2&gt;${feature.type.title}&lt;/h2&gt;
  &lt;ul&gt;
  &lt;#list feature.attributes as attribute&gt;
    &lt;#if !attribute.isGeometry&gt;
      &lt;li&gt;${attribute.name?replace("_", " ", "i")?cap_first}: 
        &lt;#if attribute.value?starts_with('http')&gt;
          &lt;a href="${attribute.value}"&gt;${attribute.value}&lt;/a&gt;
        &lt;#else&gt;
         ${attribute.value}
        &lt;/#if&gt;
      &lt;/li&gt;
    &lt;/#if&gt;
  &lt;/#list&gt;
  &lt;/ul&gt;
  &lt;/li&gt;
&lt;/#list&gt;
&lt;/ul&gt;
&lt;/code&gt;&lt;/pre&gt;
    &lt;/noscript&gt;
&lt;/div&gt;
&lt;p&gt;See the &lt;a class="reference external" href="http://docs.geoserver.org/stable/en/user/tutorials/freemarker.html"&gt;GeoServer Freemarker tutorial&lt;/a&gt; for details of where the content template needs to live. The &lt;a class="reference external" href="http://freemarker.org/docs/"&gt;Freemaker Documentation&lt;/a&gt; is comprehensive if you're interested in further customisation.&lt;/p&gt;
</summary><category term="geoserver"></category><category term="notes"></category></entry><entry><title>Using Leaflet with a custom projection and a MapProxy TMS</title><link href="http://longwayaround.org.uk/notes/using-leaflet-with-a-custom-projection-and-a-mapproxy-tms/" rel="alternate"></link><updated>2012-07-02T21:06:00+01:00</updated><author><name>walkermatt</name></author><id>tag:longwayaround.org.uk,2012-07-02:notes/using-leaflet-with-a-custom-projection-and-a-mapproxy-tms/</id><summary type="html">&lt;p&gt;&lt;strong&gt;Update 2014-05-15&lt;/strong&gt; For examples of displaying a Web Map Service (WMS) layer
in a custom projection (EPSG:27700) within Leaflet and OpenLayers 3 (ol3) see:
&lt;a class="reference external" href="https://github.com/AstunTechnology/astun-leaflet-examples"&gt;astun-leaflet-examples&lt;/a&gt; and
&lt;a class="reference external" href="https://github.com/AstunTechnology/astun-ol3-examples"&gt;astun-ol3-examples&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Update 2012-12-18&lt;/strong&gt; I've update the &lt;a class="reference external" href="https://gist.github.com/3034742"&gt;Gist&lt;/a&gt;
to reflect changes in v0.4 of Leaflet, in particular the fact that the
scale function now belongs to the CRS object instead of the Map and the
way that the TileLayer scheme is specified has changed to simply &lt;tt class="docutils literal"&gt;tms: true&lt;/tt&gt;.&lt;/p&gt;
&lt;p&gt;&lt;a class="reference external" href="http://leaflet.cloudmade.com/"&gt;Leaflet&lt;/a&gt; is a lightweight JavaScript
slippy map client well suited to use on mobile devices. It’s seen as an
alternative to &lt;a class="reference external" href="http://openlayers.org/"&gt;OpenLayers&lt;/a&gt; but takes a
different approach focusing on a small easy to use set of features.&lt;/p&gt;
&lt;p&gt;By default Leaflet allow you to display a map in one of the common
projections used to display tiles in the Google and
&lt;a class="reference external" href="http://www.openstreetmap.org/"&gt;OSM&lt;/a&gt; tile schemes and the vast
majority of examples you see use these. It is however possible to use
another projection such as a local projection like British National Grid
thanks to &lt;a class="reference external" href="https://github.com/kartena/Proj4Leaflet"&gt;Proj4Leaflet&lt;/a&gt;
which allows you to provide a &lt;a class="reference external" href="http://trac.osgeo.org/proj/"&gt;Proj4&lt;/a&gt;
projection definition and Transformation and scale functions which map
projected coordinates to grid coordinates at a given zoom.&lt;/p&gt;
&lt;p&gt;Setting up the definition is straight forward thanks to
&lt;a class="reference external" href="http://spatialreference.org"&gt;spatialreference.org&lt;/a&gt; which allows you
to look-up most projections and their definitions. In my case the
Transformation and scale functions also turned out to be simple after a
little trial and error.&lt;/p&gt;
&lt;p&gt;I’ve been using a TMS layer provided by one of the MapProxy instances
that form part of Astun Data Services, the configuration of which was as
simple as providing a URL template and setting the &lt;tt class="docutils literal"&gt;TileLayer&lt;/tt&gt; scheme
to &lt;tt class="docutils literal"&gt;tms&lt;/tt&gt;.&lt;/p&gt;
&lt;p&gt;I’ve posted an example JavaScript snippet as a GitHub Gist with some
notes here:
&lt;a class="reference external" href="https://gist.github.com/3034742"&gt;https://gist.github.com/3034742&lt;/a&gt;&lt;/p&gt;
</summary><category term="leaflet"></category><category term="mapproxy"></category></entry><entry><title>Greyscale maps with MapServer</title><link href="http://longwayaround.org.uk/notes/greyscale-maps-with-mapserver/" rel="alternate"></link><updated>2012-02-02T21:31:00+00:00</updated><author><name>walkermatt</name></author><id>tag:longwayaround.org.uk,2012-02-02:notes/greyscale-maps-with-mapserver/</id><summary type="html">&lt;p&gt;There have been a few times in the past (such as when I was preparing the base mapping for &lt;a class="reference external" href="http://mywycombe.wycombe.gov.uk/?tab=2"&gt;My Wycombe&lt;/a&gt;) when I've wanted to create greyscale base mapping using &lt;a class="reference external" href="http://mapserver.org"&gt;MapServer&lt;/a&gt;. Previously I've experimented with various processing options for raster images (with varying degrees of success), converting the source images using &lt;a class="reference external" href="www.imagemagick.org"&gt;ImageMagick&lt;/a&gt; and converting colour RGB values to their greyscale equivalent for vector features and it's generally been time consuming.  Today the requirement came up again and I discovered a far simpler option: specifying a greyscale palette as an OUTPUTFORMAT FORMATOPTION.  The palette simply contains grey values from 0,0,0 (black) to 255,255,255 (white) and all values in between. MapServer then does the job of converting the colours for your source data into their greyscale equivalents.&lt;/p&gt;
&lt;p&gt;In the map file specify an &lt;a class="reference external" href="http://mapserver.org/mapfile/outputformat.html"&gt;OUTPUTFORMAT&lt;/a&gt; that used a specific palette:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
# Specify a plain PNG output with a

# greyscale palette

IMAGETYPE &amp;quot;AGG_PNG&amp;quot;

OUTPUTFORMAT

    NAME  &amp;quot;AGG_PNG&amp;quot;

    DRIVER  &amp;quot;AGG/PNG&amp;quot;

    MIMETYPE &amp;quot;image/png&amp;quot;

    IMAGEMODE &amp;quot;RGB&amp;quot;

    EXTENSION &amp;quot;png&amp;quot;

    FORMATOPTION &amp;quot;INTERLACE=OFF&amp;quot;

    FORMATOPTION &amp;quot;PALETTE_FORCE=ON&amp;quot;

    FORMATOPTION &amp;quot;PALETTE=grey.txt&amp;quot;

END
&lt;/pre&gt;
&lt;p&gt;Snippet from the palette file (&lt;a class="reference external" href="/files/grey.txt"&gt;download the full version&lt;/a&gt;):&lt;/p&gt;
&lt;pre class="literal-block"&gt;
0,0,0

1,1,1

2,2,2

--- you get the idea ---

253,253,253

254,254,254

255,255,255
&lt;/pre&gt;
&lt;p&gt;BTW I used the following Python to generate the values for the palette:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="nb"&gt;range&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;256&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;

    &lt;span class="k"&gt;print&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;&lt;/span&gt;&lt;span class="si"&gt;%i&lt;/span&gt;&lt;span class="s"&gt;,&lt;/span&gt;&lt;span class="si"&gt;%i&lt;/span&gt;&lt;span class="s"&gt;,&lt;/span&gt;&lt;span class="si"&gt;%i&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
</summary><category term="mapserver"></category></entry><entry><title>Disaggregate MultiLineStrings using ST_Dump PostGIS</title><link href="http://longwayaround.org.uk/notes/disaggregate-multilinestrings-using-st_dump-postgis/" rel="alternate"></link><updated>2011-11-24T21:39:00+00:00</updated><author><name>walkermatt</name></author><id>tag:longwayaround.org.uk,2011-11-24:notes/disaggregate-multilinestrings-using-st_dump-postgis/</id><summary type="html">&lt;p&gt;PostGIS the spatial extension to the PostgreSQL database provides a host of functions for querying, creating and manipulating geometries within the database. ST_Dump allows you to disaggregate collection and multi geometries such as MultiPolygon and MultiLineSting easily. The example below demonstrates starting with a table that contains one row with a MultiLineString geometry and another with a LineString and running a query to disaggregate returning three rows all with a LineString geometry.&lt;/p&gt;
&lt;p&gt;Create a table for our demo data:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="k"&gt;CREATE&lt;/span&gt; &lt;span class="k"&gt;TABLE&lt;/span&gt; &lt;span class="n"&gt;complex&lt;/span&gt;

&lt;span class="p"&gt;(&lt;/span&gt;

   &lt;span class="n"&gt;id&lt;/span&gt; &lt;span class="nb"&gt;serial&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;

   &lt;span class="ss"&gt;&amp;quot;name&amp;quot;&lt;/span&gt; &lt;span class="nb"&gt;text&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;

   &lt;span class="n"&gt;geom&lt;/span&gt; &lt;span class="n"&gt;geometry&lt;/span&gt;

&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Insert one row with a MultiLineString with two parts ('Bob') and another with a single LineString ('Harry')&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="k"&gt;INSERT&lt;/span&gt; &lt;span class="k"&gt;INTO&lt;/span&gt; &lt;span class="n"&gt;complex&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;geom&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

  &lt;span class="k"&gt;VALUES&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;

    &lt;span class="s1"&gt;&amp;#39;Bob&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;

    &lt;span class="n"&gt;ST_GeomFromEWKT&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;MULTILINESTRING((498376.89 651569.6,498372.28 651571.89),(498372.28 651571.89,498371.77 651576.05))&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

  &lt;span class="p"&gt;);&lt;/span&gt;



&lt;span class="k"&gt;INSERT&lt;/span&gt; &lt;span class="k"&gt;INTO&lt;/span&gt; &lt;span class="n"&gt;complex&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;geom&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

  &lt;span class="k"&gt;VALUES&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;

    &lt;span class="s1"&gt;&amp;#39;Harry&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;

    &lt;span class="n"&gt;ST_GeomFromEWKT&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;LINESTRING(598376.89 751569.6,398372.75 658771.03)&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

  &lt;span class="p"&gt;);&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Query to show we have two rows one of which has a MultiLineString geometry:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="k"&gt;SELECT&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;ST_GeometryType&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;geom&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="n"&gt;geom_type&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;ST_AsEWKT&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;geom&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="n"&gt;geom_wkt&lt;/span&gt; &lt;span class="k"&gt;from&lt;/span&gt; &lt;span class="n"&gt;complex&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Results:&lt;/p&gt;
&lt;table border="1" class="docutils"&gt;
&lt;colgroup&gt;
&lt;col width="2%" /&gt;
&lt;col width="4%" /&gt;
&lt;col width="18%" /&gt;
&lt;col width="13%" /&gt;
&lt;col width="62%" /&gt;
&lt;/colgroup&gt;
&lt;thead valign="bottom"&gt;
&lt;tr&gt;&lt;th class="head"&gt;id&lt;/th&gt;
&lt;th class="head"&gt;name&lt;/th&gt;
&lt;th class="head"&gt;geom&lt;/th&gt;
&lt;th class="head"&gt;geom_type&lt;/th&gt;
&lt;th class="head"&gt;geom_wkt&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;Bob&lt;/td&gt;
&lt;td&gt;010500000002000000010200...&lt;/td&gt;
&lt;td&gt;ST_MultiLineString&lt;/td&gt;
&lt;td&gt;MULTILINESTRING((498376.89 651569.6,498372.28 651571.89),(498372.28 651571.89,498371.77 651576.05))&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;Harry&lt;/td&gt;
&lt;td&gt;0102000000020000007B14AE...&lt;/td&gt;
&lt;td&gt;ST_LineString&lt;/td&gt;
&lt;td&gt;LINESTRING(598376.89 751569.6,598372.28 751571.89)&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;Use the ST_Dump function to split the row with a MultiLineString into two rows each with a LineString and generate a decimal id composed of the original rows id and the LineString's position in the MultiLineString as the fractional part so that each row still has a unique id that's derived from it's original id:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="k"&gt;SELECT&lt;/span&gt;

  &lt;span class="n"&gt;COALESCE&lt;/span&gt;&lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="k"&gt;simple&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt; &lt;span class="o"&gt;||&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;.&amp;#39;&lt;/span&gt; &lt;span class="o"&gt;||&lt;/span&gt; &lt;span class="k"&gt;simple&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]::&lt;/span&gt;&lt;span class="nb"&gt;text&lt;/span&gt;&lt;span class="p"&gt;)::&lt;/span&gt;&lt;span class="nb"&gt;float&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="k"&gt;simple&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;

  &lt;span class="k"&gt;simple&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;

  &lt;span class="k"&gt;simple&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;simple_geom&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="n"&gt;geom&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;

  &lt;span class="n"&gt;ST_GeometryType&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;simple&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;simple_geom&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="n"&gt;geom_type&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;

  &lt;span class="n"&gt;ST_AsEWKT&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;simple&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;simple_geom&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="n"&gt;geom_wkt&lt;/span&gt;

&lt;span class="k"&gt;FROM&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;

  &lt;span class="k"&gt;SELECT&lt;/span&gt;

    &lt;span class="n"&gt;dumped&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;

    &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;dumped&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;geom_dump&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="n"&gt;geom&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="n"&gt;simple_geom&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;

    &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;dumped&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;geom_dump&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="n"&gt;path&lt;/span&gt;

  &lt;span class="k"&gt;FROM&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;

    &lt;span class="k"&gt;SELECT&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;ST_Dump&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;geom&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;AS&lt;/span&gt; &lt;span class="n"&gt;geom_dump&lt;/span&gt; &lt;span class="k"&gt;FROM&lt;/span&gt; &lt;span class="n"&gt;complex&lt;/span&gt;

  &lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="n"&gt;dumped&lt;/span&gt;

&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;AS&lt;/span&gt; &lt;span class="k"&gt;simple&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Results:&lt;/p&gt;
&lt;table border="1" class="docutils"&gt;
&lt;colgroup&gt;
&lt;col width="5%" /&gt;
&lt;col width="6%" /&gt;
&lt;col width="26%" /&gt;
&lt;col width="15%" /&gt;
&lt;col width="48%" /&gt;
&lt;/colgroup&gt;
&lt;thead valign="bottom"&gt;
&lt;tr&gt;&lt;th class="head"&gt;id&lt;/th&gt;
&lt;th class="head"&gt;name&lt;/th&gt;
&lt;th class="head"&gt;geom&lt;/th&gt;
&lt;th class="head"&gt;geom_type&lt;/th&gt;
&lt;th class="head"&gt;geom_wkt&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td&gt;1.1&lt;/td&gt;
&lt;td&gt;Bob&lt;/td&gt;
&lt;td&gt;010200000002000000F6285C...&lt;/td&gt;
&lt;td&gt;ST_LineString&lt;/td&gt;
&lt;td&gt;LINESTRING(498376.89 651569.6,498372.28 651571.89)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;1.2&lt;/td&gt;
&lt;td&gt;Bob&lt;/td&gt;
&lt;td&gt;010200000002000000EC51B8...&lt;/td&gt;
&lt;td&gt;ST_LineString&lt;/td&gt;
&lt;td&gt;LINESTRING(498372.28 651571.89,498371.77 651576.05)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;Harry&lt;/td&gt;
&lt;td&gt;0102000000020000007B14AE...&lt;/td&gt;
&lt;td&gt;ST_LineString&lt;/td&gt;
&lt;td&gt;LINESTRING(598376.89 751569.6,598372.28 751571.89)&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
</summary><category term="postgis"></category></entry><entry><title>Recursively delete empty directories</title><link href="http://longwayaround.org.uk/notes/recursively-delete-empty-directories/" rel="alternate"></link><updated>2011-03-28T10:31:00+01:00</updated><author><name>walkermatt</name></author><id>tag:longwayaround.org.uk,2011-03-28:notes/recursively-delete-empty-directories/</id><summary type="html">&lt;p&gt;To recursively delete all empty directories from the command prompt in Windows. Open command prompt and change to the desired directory then enter the following:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="k"&gt;for&lt;/span&gt; /F &lt;span class="s2"&gt;&amp;quot;tokens=*&amp;quot;&lt;/span&gt; %f in &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;dir /AD /S /B ^| sort /R&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="k"&gt;do &lt;/span&gt;&lt;span class="nb"&gt;echo &lt;/span&gt;rd &lt;span class="s2"&gt;&amp;quot;%f&amp;quot;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This command generates a list of all directories and sub directories below the current directory in bare format (just the path) sorted in reverse order. The remove directory command (rd) is then called for each item in the list. The rd command will only delete empty directories so those directories containing files or other directories will not be deleted.&lt;/p&gt;
</summary><category term="command-line"></category><category term="notes"></category></entry><entry><title>Convert a directory of TIFFs to greyscale using ImageMagick</title><link href="http://longwayaround.org.uk/notes/convert-a-directory-of-tiffs-to-greyscale-using-imagemagick/" rel="alternate"></link><updated>2011-01-07T17:53:00+00:00</updated><author><name>walkermatt</name></author><id>tag:longwayaround.org.uk,2011-01-07:notes/convert-a-directory-of-tiffs-to-greyscale-using-imagemagick/</id><summary type="html">&lt;p&gt;Change to the directory then run the command:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;mogrify -colorspace Gray *.tif
&lt;/pre&gt;&lt;/div&gt;
</summary><category term="command-line"></category><category term="notes"></category></entry><entry><title>Build OGR 1.8 with GML, WFS and PostGIS support on Ubuntu 10.04</title><link href="http://longwayaround.org.uk/notes/build-ogr-18-with-gml-wfs-and-postgis-support-on-ubuntu-1004/" rel="alternate"></link><updated>2010-12-19T21:06:00+00:00</updated><author><name>walkermatt</name></author><id>tag:longwayaround.org.uk,2010-12-19:notes/build-ogr-18-with-gml-wfs-and-postgis-support-on-ubuntu-1004/</id><summary type="html">&lt;p&gt;OGR 1.8 introduces support for reading GML with feature attributes expressed as nested elements as found in Ordnance Survey's OS MasterMap as well as support for accessing WFS. This is a brief script for building OGR (GDAL) 1.8 from source as it's not currently released: Download latest daily source export: &lt;a class="reference external" href="http://www.gdal.org/daily/"&gt;http://www.gdal.org/daily/&lt;/a&gt; and extract it's contents to a directory you have read, write and execute permissions in (I chose ~/Software/gdal-svn-trunk-2010.12.19) Ensure you have the tools required to build software using &lt;tt class="docutils literal"&gt;make&lt;/tt&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;sudo apt-get install build-essential
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Install the development package for Xerces-C:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;sudo apt-get install libxerces-c-dev
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Install the PostgreSQL development tools package:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;sudo apt-get install libpq-dev
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Install curl and the development package:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;sudo apt-get install curl libcurl4-gnutls-dev
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Change to the directory where you extracted the GDAL source (that's ~/Software/gdal-svn-trunk-2010.12.19 for me):&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nb"&gt;cd&lt;/span&gt; ~/Software/gdal-svn-trunk-2010.12.19
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Run the configure script which prepares the ground before we build GDAL with &lt;tt class="docutils literal"&gt;make&lt;/tt&gt;. Here we are specifying that we want to configure the build to include xerces support and PostgreSQL (/usr/bin/pg_config is a script provided with the PostgreSQL development tools package).&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;./configure --with-xerces&lt;span class="o"&gt;=&lt;/span&gt;yes --with-pg&lt;span class="o"&gt;=&lt;/span&gt;/usr/bin/pg_config --with-curl&lt;span class="o"&gt;=&lt;/span&gt;/usr/bin/curl-config &amp;gt; configure-output.txt
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Now we can actually build GDAL/OGR:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;make &amp;gt; make-output.txt
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Providing make did not error GDAL should now be built and ready to use.  You can find the executable utilities such as gdalinfo, ogrinfo, ogr2ogr etc. in the apps directory within the directory that you extracted the GDAL source (~/Software/gdal-svn-trunk-2010.12.19/apps/ogr2ogr for me.); to make it easier to run these utilities it may be worthwhile setting a variable to this path:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;GDAL_PATH&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;~/Software/gdal-svn-trunk-2010.12.19/apps/
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;It's also worth setting the GDAL_DATA environment variable so that resources such as coordinate system definitions etc.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nb"&gt;export &lt;/span&gt;&lt;span class="nv"&gt;GDAL_DATA&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nv"&gt;$GDAL_PATH&lt;/span&gt;../data
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;You can then use the utilities like so: Translate from GML to ESRI Shape. To parse nested feature attributes you will need to modify the .gfs file generated the first time the GML file is opened. The .gfs file allows you to map GML properties to feature attributes.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;$GDAL_PATH&lt;/span&gt;/ogr2ogr -f &lt;span class="s1"&gt;&amp;#39;ESRI Shapefile&amp;#39;&lt;/span&gt; . test.gml
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Translate GML to PostGIS&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;$GDAL_PATH&lt;/span&gt;/ogr2ogr -f PostgreSQL PG:&lt;span class="s2"&gt;&amp;quot;dbname=&amp;#39;postgis&amp;#39; active_schema=mapbase host=&amp;#39;localhost&amp;#39; user=&amp;#39;fred&amp;#39; password=&amp;#39;itscomplicated&amp;#39;&amp;quot;&lt;/span&gt; test.gml
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;List available layers from a WFS&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;$GDAL_PATH&lt;/span&gt;/ogrinfo -ro WFS:&lt;span class="s2"&gt;&amp;quot;http://www.tinyows.org/cgi-bin/tinyows&amp;quot;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Get info about all features in a given layer including coordinates&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;$GDAL_PATH&lt;/span&gt;/ogrinfo WFS:&lt;span class="s2"&gt;&amp;quot;http://www.tinyows.org/cgi-bin/tinyows&amp;quot;&lt;/span&gt; tows:world -ro -al
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Download all features from a layer and write to a good old ESRI Shape file&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;$GDAL_PATH&lt;/span&gt;/ogr2ogr -f &lt;span class="s1"&gt;&amp;#39;ESRI Shapefile&amp;#39;&lt;/span&gt; . WFS:&lt;span class="s2"&gt;&amp;quot;http://www.tinyows.org/cgi-bin/tinyows&amp;quot;&lt;/span&gt; tows:world
&lt;/pre&gt;&lt;/div&gt;
</summary><category term="gml"></category><category term="ogr"></category><category term="postgis"></category><category term="wfs"></category></entry></feed>